hf_xZDGLqZTAouKJvsCdHHHbHKZTPzYUUBgZ e



# 下载并安装 Google Cloud SDK（包含 gsutil）
curl -O https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-cli-460.0.0-linux-x86_64.tar.gz
tar -xf google-cloud-cli-460.0.0-linux-x86_64.tar.gz
./google-cloud-sdk/install.sh --quiet

# 添加路径
source ./google-cloud-sdk/path.bash.inc

gsutil version

gsutil ls gs://gresearch/android_control/

gsutil -m cp -r gs://gresearch/android_control/ ./android_control/

(torch_cmx) root@mm-fudan-chai-l20-1-0:/opt/nas/p/mm/ie_env/cmx/HONOR_TEST3# gsutil ls gs://gresearch/android_control/
gs://gresearch/android_control/
gs://gresearch/android_control/android_control-00000-of-00020
gs://gresearch/android_control/android_control-00001-of-00020
gs://gresearch/android_control/android_control-00002-of-00020
gs://gresearch/android_control/android_control-00003-of-00020
gs://gresearch/android_control/android_control-00004-of-00020
gs://gresearch/android_control/android_control-00005-of-00020
gs://gresearch/android_control/android_control-00006-of-00020
gs://gresearch/android_control/android_control-00007-of-00020
gs://gresearch/android_control/android_control-00008-of-00020
gs://gresearch/android_control/android_control-00009-of-00020
gs://gresearch/android_control/android_control-00010-of-00020
gs://gresearch/android_control/android_control-00011-of-00020
gs://gresearch/android_control/android_control-00012-of-00020
gs://gresearch/android_control/android_control-00013-of-00020
gs://gresearch/android_control/android_control-00014-of-00020
gs://gresearch/android_control/android_control-00015-of-00020
gs://gresearch/android_control/android_control-00016-of-00020
gs://gresearch/android_control/android_control-00017-of-00020
gs://gresearch/android_control/android_control-00018-of-00020
gs://gresearch/android_control/android_control-00019-of-00020
gs://gresearch/android_control/splits.json
gs://gresearch/android_control/test_subsplits.json

创建一个目录
(torch_cmx) root@mm-fudan-chai-l20-1-0:/opt/nas/p/mm/ie_env/cmx/HONOR_TEST3# gsutil -m cp gs://gresearch/android_control/* ./android_control/


import json
import os

def function(template_path, input_file, outout_file):
    f = open(template_path).readlines()

    input_list = []
    for item in f:
        item = json.loads(item)
        input_list.append(item)

    compare_list = {}

    f = open(input_file).readlines()
    for item in f:
        item = json.loads(item)
        compare_list[item["images"][0]["path"]] = item["response"]

    for item in input_list:
        img = item["image_path"]
        response = compare_list[img]

        if "before_trans" in item:
            before_trans = item["before_trans"]
            item["before_trans"] = response
            item["generate_content"] = item["generate_content"].replace(before_trans, response)

        result = {"STATUS": "continue"}
        
        # auxiliary function to extract coordinates
        def extract_coords(s):
            # directly find and extract the coordinates in the parentheses
            start = s.find("(")
            end = s.find(")")
            if start != -1 and end != -1:
                coords_str = s[start+1:end].strip()  # extract the content in (x,y)
                x, y = coords_str.split(",")
                return [int(x), int(y)]
            raise ValueError(f"Cannot find coordinates in the string: {s}")
        
        if "tap(" in response:
            result["POINT"] = extract_coords(response)
            
        elif "long_press(" in response:
            result["POINT"] = extract_coords(response)
            result["duration"] = 1000
                
        elif "text(" in response:
            content = response.split(",")[-1][:-1]
            result["TYPE"] = content
            
        elif "scroll(" in response:
            direction = response.split(",")[-1][:-1]
            result["POINT"] = [0, 0]  # screen center point
            result["to"] = direction
        elif "navigate_back" in response:
            result["PRESS"] = "BACK"

        elif "navigate_home" in response:
             result["PRESS"] = "HOME"

        elif "wait()" in response:
            result["duration"] = 500
    
        elif "finish()" in response or "Finish()" in response:
            result["STATUS"] = "finish"

        else:
            print(response)

        item["pred"] = result

    outout_path = "/".join(outout_file.split("/")[:-1])
    if not os.path.exists(outout_path):
        os.makedirs(outout_path)
    
    with open(outout_file, 'w', encoding='utf-8') as f:
        for item in input_list:
            json_line = json.dumps(item, ensure_ascii=False)
            f.write(json_line + '\n')

function(template_path="/opt/nas/p/dongshaokang/AgentCPM-GUI/eval/eval_results/V1/CPT630/android_control_low_test_v1/all_copy2.jsonl",
         input_file="/opt/nas/p/dongshaokang/AgentCPM-GUI/eval/eval_data/android_control_honor_inital_test/CPT729/infer_full_hl/response_ac_hl_nothink.json", 
         outout_file='/opt/nas/p/dongshaokang/AgentCPM-GUI/eval/eval_results/V2-Finish-Test/CPT729/ac_low/all.jsonl')


Traceback (most recent call last):
  File "/opt/nas/p/conda/envs/process_data_cmx/lib/python3.10/site-packages/urllib3/connectionpool.py", line 534, in _make_request
    response = conn.getresponse()████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3.19M/3.19M [00:04<00:00, 751kB/s]
  File "/opt/nas/p/conda/envs/process_data_cmx/lib/python3.10/site-packages/urllib3/connection.py", line 565, in getresponse 
    httplib_response = super().getresponse()
  File "/opt/nas/p/conda/envs/process_data_cmx/lib/python3.10/http/client.py", line 1375, in getresponse
    response.begin()
  File "/opt/nas/p/conda/envs/process_data_cmx/lib/python3.10/http/client.py", line 318, in begin
    version, status, reason = self._read_status()
  File "/opt/nas/p/conda/envs/process_data_cmx/lib/python3.10/http/client.py", line 279, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "/opt/nas/p/conda/envs/process_data_cmx/lib/python3.10/socket.py", line 717, in readinto
    return self._sock.recv_into(b)
  File "/opt/nas/p/conda/envs/process_data_cmx/lib/python3.10/ssl.py", line 1307, in recv_into
    return self.read(nbytes, buffer)
  File "/opt/nas/p/conda/envs/process_data_cmx/lib/python3.10/ssl.py", line 1163, in read
    return self._sslobj.read(len, buffer)
TimeoutError: The read operation timed out

The above exception was the direct cause of the following exception:

